# Oh My Zsh Configuration
export ZSH="$HOME/.oh-my-zsh"
ZSH_THEME="xiong-chiamiov-plus"

# Plugins
plugins=(
    git
    zsh-autosuggestions
    zsh-syntax-highlighting
)

# Aliases
alias vim=nvim
alias cat='batcat'
alias logout='pkill -KILL -u $USER'
alias please=please
alias rm='rm -i'
alias mv='mv -i'
alias cp='cp -i'
alias cdl=cd_ls
alias mcd=mkdir_cd_dir
alias ..='cd ..'
alias ...='cd ../../'
alias fadd='git add $(git status -s | cut -c4- | sed "s/\"//g" | fzf)'

# Color support
alias ls='ls --color=auto'
alias dir='dir --color=auto'
alias vdir='vdir --color=auto'
alias grep='grep --color=auto'
alias fgrep='fgrep --color=auto'
alias egrep='egrep --color=auto'
alias ll='ls -alF'
alias la='ls -A'
alias l='ls -CF'

# Navigation Functions
function cd_ls() {
    cd "$1"
    if [ $? -eq 0 ]; then
        ls -A
    fi
}

function mkdir_cd_dir() {
    mkdir "$1"
    cd "$1"
}

# Completion
# Note: The following completion is for bash, not zsh
# Commented out to prevent errors
# complete -F cd_completion cdl
# cd_completion() {
#     local dir_list
#     dir_list=$(compgen -d -- "$1")
#     COMPREPLY=($dir_list)
# }

# Enable zsh completion system
autoload -Uz compinit
compinit

# Please Function
function please() {
    if [ -n "$HISTFILE" ] && [ "$HISTCMD" -gt 1 ]; then
        local last_cmd=$(fc -ln -1 | sed 's/^[ ]*//g' | sed 's/^sudo //g')
        if [[ "$last_cmd" == "please" ]]; then
            echo "No previous command to execute!"
            return 1
        fi
        \cat << "EOF"
        _____  *    * *    * * *_
        |  __ \| |  | | |  | | | | |
        | |  | | |  | | |__| | | | |
        | |  | | |  | |  __  | | | |
        | |__| | |__| | |  | |_|_|_|
        |_____/ \____/|_|  |_(_|_|_)
        just this one time...
EOF
        sudo $last_cmd
    else
        echo "No previous command found in history!"
    fi
}

# Git Repository Greeter
last_repository=
function check_directory_for_new_repository() {
    current_repository=$(git rev-parse --show-toplevel 2> /dev/null)
    if [ "$current_repository" ] && \
       [ "$current_repository" != "$last_repository" ]; then
        onefetch
    fi
    last_repository=$current_repository
}

# Override cd command
function cd() {
    builtin cd "$@"
    check_directory_for_new_repository
}

# Initial repository check
check_directory_for_new_repository

# Source configurations
# Check if Oh My Zsh exists before sourcing
if [ -f "$ZSH/oh-my-zsh.sh" ]; then
    source "$ZSH/oh-my-zsh.sh"
fi

# Check if intelli-shell exists before sourcing
if [ -n "$INTELLI_HOME" ] && [ -f "$INTELLI_HOME/bin/intelli-shell.sh" ]; then
    source "$INTELLI_HOME/bin/intelli-shell.sh"
fi

# Check if starship exists before initializing
if command -v starship &> /dev/null; then
    eval "$(starship init zsh)"
fi

# Ensure colors are enabled for the terminal
export CLICOLOR=1
export LSCOLORS=ExGxBxDxCxEgEdxbxgxcxd
